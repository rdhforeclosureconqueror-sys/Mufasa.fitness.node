<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fitness MVP ¬∑ Ma‚Äôat + Mufasa System Blueprint</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #0b0c10;
      color: #f5f5f5;
      line-height: 1.6;
    }
    header {
      background: linear-gradient(135deg, #1f2833, #0b0c10);
      padding: 24px 32px;
      border-bottom: 1px solid #45a29e;
    }
    header h1 {
      margin: 0;
      font-size: 26px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }
    header p {
      margin: 8px 0 0;
      max-width: 800px;
      color: #c5c6c7;
    }
    main {
      padding: 24px 32px 48px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h2, h3, h4 {
      color: #66fcf1;
      margin-top: 32px;
    }
    h2 {
      border-bottom: 1px solid #45a29e;
      padding-bottom: 4px;
    }
    h3 {
      margin-top: 24px;
    }
    p, li {
      color: #eaeaea;
    }
    a {
      color: #66fcf1;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .toc {
      border: 1px solid #45a29e;
      border-radius: 8px;
      padding: 16px 20px;
      background: #1f2833;
      margin-bottom: 24px;
    }
    .toc h2 {
      border: none;
      padding-bottom: 0;
      margin-top: 0;
      margin-bottom: 8px;
    }
    .toc ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
    }
    .toc li {
      margin: 2px 0;
      font-size: 14px;
    }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      background: #45a29e33;
      border: 1px solid #45a29e99;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-right: 4px;
    }
    .card {
      border-radius: 8px;
      border: 1px solid #45a29e55;
      background: #1f2833;
      padding: 16px 18px;
      margin: 16px 0;
    }
    code {
      font-family: "SFMono-Regular", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
      background: #0b0c10;
      padding: 1px 4px;
      border-radius: 4px;
    }
    pre {
      background: #0b0c10;
      border-radius: 8px;
      padding: 12px 14px;
      overflow-x: auto;
      font-size: 12px;
      border: 1px solid #45a29e44;
    }
    .checklist li::marker {
      color: #66fcf1;
    }
    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 6px 0 10px;
    }
    .meta {
      font-size: 12px;
      color: #c5c6c7;
    }
    .highlight {
      color: #66fcf1;
      font-weight: 600;
    }
  </style>
</head>
<body>
<header>
  <h1>Fitness MVP ¬∑ Ma‚Äôat + Mufasa System Blueprint</h1>
  <p>
    This document describes the entire Fitness MVP ecosystem:
    Google Sheets, AppSheet, Apps Script, Discord, Unity/AR Coach,
    and the external Big Brain (Ma‚Äôat) working under the governance of Mufasa.
    It is written so a coding bot (or future you) can rebuild everything from scratch.
  </p>
</header>

<main>
  <section class="toc">
    <h2>Table of Contents</h2>
    <ul>
      <li><a href="#overview">0. One-Sentence Overview</a></li>
      <li><a href="#architecture">1. High-Level Architecture</a></li>
      <li><a href="#sheets">2. Google Sheet Tabs & Schemas</a></li>
      <li><a href="#apps-script">3. Apps Script Modules & Logic</a></li>
      <li><a href="#brain-api">4. Big Brain API (Ma‚Äôat)</a></li>
      <li><a href="#appsheet">5. AppSheet App (Today View & Forms)</a></li>
      <li><a href="#discord">6. Discord Structure & Event Flow</a></li>
      <li><a href="#unity">7. Unity / AR Coach & Firebase</a></li>
      <li><a href="#rebuild-checklist">8. Fresh-Start Rebuild Checklist</a></li>
    </ul>
  </section>

  <section id="overview">
    <h2>0. One-Sentence Overview</h2>
    <p>
      <span class="highlight">Fitness MVP</span> is a wellness operating system:
      a Google Sheet + AppSheet app + Apps Script bots + Discord + Unity/AR coach,
      all wired into an external <span class="highlight">Big Brain</span> API (Ma‚Äôat) that does the thinking,
      while <span class="highlight">Mufasa</span> (Apps Script governance layer) and your bots actually execute changes.
    </p>
  </section>

  <section id="architecture">
    <h2>1. High-Level Architecture</h2>
    <div class="card">
      <div class="badge-row">
        <span class="pill">Data Layer</span>
        <span class="pill">Logic Layer</span>
        <span class="pill">Frontends</span>
        <span class="pill">Governance</span>
      </div>
      <h3>1.1 Layers</h3>
      <ul>
        <li><strong>Data Layer</strong>
          <ul>
            <li><strong>Google Sheet</strong> ‚Äì truth for users, plans, points, events, suggestions, heal queue.</li>
            <li><strong>Firebase (Firestore)</strong> ‚Äì coach scripts (Brain ‚Üí Unity) and session logs (Unity ‚Üí Brain).</li>
          </ul>
        </li>
        <li><strong>Logic Layer</strong>
          <ul>
            <li><strong>Apps Script</strong>
              <ul>
                <li>Talks to the Big Brain API (Ma‚Äôat).</li>
                <li>Posts to Discord via webhooks.</li>
                <li>Reads/writes the Sheet and applies point rules.</li>
              </ul>
            </li>
            <li><strong>Big Brain API (Ma‚Äôat)</strong>
              <ul>
                <li><code>POST /plan/workout</code> ‚Äì generates plans.</li>
                <li><code>POST /mvp/weekly_snapshot</code> ‚Äì returns suggestions.</li>
                <li><code>POST /mvp/session_log</code> ‚Äì ingests Unity data.</li>
                <li><code>POST /mvp/health_snapshot</code> ‚Äì returns auto-heal actions.</li>
              </ul>
            </li>
          </ul>
        </li>
        <li><strong>Frontends</strong>
          <ul>
            <li><strong>AppSheet</strong> ‚Äì Today screen, check-ins, plan view.</li>
            <li><strong>Discord</strong> ‚Äì community, check-ins, leaderboards, motivation.</li>
            <li><strong>Unity/AR</strong> ‚Äì 3D coach avatar following scripts from Brain.</li>
          </ul>
        </li>
        <li><strong>Governance</strong>
          <ul>
            <li><strong>Mufasa</strong> (Apps Script module) ‚Äì king/gatekeeper.</li>
            <li><strong>Ma‚Äôat</strong> (Big Brain) ‚Äì strategist & healer, proposes, never directly edits Sheets.</li>
          </ul>
        </li>
      </ul>

      <h3>1.2 Simple Flow</h3>
      <pre><code>Discord / AppSheet / Unity
        ‚Üì events
      Events tab in Sheet
        ‚Üì points rules
      PointsLedger & Leaderboard
        ‚Üì weekly snapshot
      Big Brain (Ma‚Äôat)
        ‚Üì suggestions / plan_tweaks / heal actions
      Brain_Suggestions & Mufasa_HealQueue
        ‚Üì approved via Mufasa + bots
      Updated plans, notifications, scripts, & triggers</code></pre>
    </div>
  </section>

  <section id="sheets">
    <h2>2. Google Sheet Tabs & Schemas</h2>

    <h3>2.1 <code>00_Config</code></h3>
    <p><strong>Purpose:</strong> global config for all scripts & bots.</p>
    <ul>
      <li><strong>Columns:</strong> <code>Key</code>, <code>Value</code></li>
      <li><strong>Important keys:</strong>
        <ul>
          <li><code>brainBaseUrl</code> ‚Äì e.g. <code>http://192.168.1.199:7729</code></li>
          <li><code>brainApiKey</code></li>
          <li><code>brainTenantId</code> ‚Äì <code>fitness_mvp</code></li>
          <li><code>discord_webhook_water</code>, <code>discord_webhook_meals</code>,
              <code>discord_webhook_workouts</code>, <code>discord_webhook_affirmations</code>,
              <code>discord_webhook_leaderboard</code>, <code>discord_webhook_motivation</code></li>
          <li><code>points_double_count_window_minutes</code> ‚Äì e.g. <code>30</code></li>
        </ul>
      </li>
    </ul>

    <h3>2.2 <code>Users</code></h3>
    <p><strong>Purpose:</strong> canonical user registry.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>UserID</code> (canonical ID used everywhere)</li>
          <li><code>DisplayName</code></li>
          <li><code>Email</code></li>
          <li><code>DiscordHandle</code></li>
          <li><code>Role</code> (member/coach/admin)</li>
          <li><code>PlanType</code> (e.g. <code>gymnastics-l4-5</code>, <code>weight-loss</code>)</li>
          <li><code>WorkoutsPerWeekTarget</code></li>
          <li><code>StartDate</code></li>
          <li><code>Status</code> (active/paused)</li>
          <li><code>Tags</code> (e.g. <code>gymnastics,youth,elite-track</code>)</li>
          <li><code>Notes</code></li>
        </ul>
      </li>
    </ul>

    <h3>2.3 <code>Plans</code></h3>
    <p><strong>Purpose:</strong> store plans returned from Ma‚Äôat.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>PlanID</code></li>
          <li><code>UserID</code></li>
          <li><code>PlanType</code></li>
          <li><code>StartDate</code></li>
          <li><code>DurationWeeks</code></li>
          <li><code>SessionsPerWeek</code></li>
          <li><code>PlanJson</code> (raw JSON from <code>/plan/workout</code>)</li>
          <li><code>Status</code> (active/complete/archived)</li>
        </ul>
      </li>
    </ul>

    <h3>2.4 <code>Sessions</code></h3>
    <p><strong>Purpose:</strong> high-level summary of each training session.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>SessionID</code></li>
          <li><code>UserID</code></li>
          <li><code>PlanID</code></li>
          <li><code>Date</code></li>
          <li><code>Source</code> (Unity/Discord/AppSheetManual)</li>
          <li><code>DurationMinutes</code></li>
          <li><code>RPE</code></li>
          <li><code>Mood</code></li>
          <li><code>Notes</code></li>
        </ul>
      </li>
    </ul>

    <h3>2.5 <code>Events</code></h3>
    <p><strong>Purpose:</strong> raw behavior feed (Discord, Forms, Unity ‚Üí points engine).</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>EventID</code> (unique)</li>
          <li><code>UserID</code></li>
          <li><code>Timestamp</code></li>
          <li><code>EventType</code> (water_morning, meal_post, affirmation_text, workout_checkin_video, etc.)</li>
          <li><code>Source</code> (discord, form, unity, manual)</li>
          <li><code>PayloadJson</code> (raw data like meal ingredients, message IDs)</li>
          <li><code>PointsAwarded</code></li>
          <li><code>DeDupeKey</code> (e.g. <code>userId|date|category</code>)</li>
          <li><code>Status</code> (pending, applied, ignored_duplicate, error)</li>
        </ul>
      </li>
    </ul>

    <h3>2.6 <code>PointsLedger</code></h3>
    <p><strong>Purpose:</strong> daily points per user.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>UserID</code></li>
          <li><code>Date</code></li>
          <li><code>WaterPoints</code></li>
          <li><code>MealPoints</code></li>
          <li><code>AffirmationPoints</code></li>
          <li><code>WorkoutPoints</code></li>
          <li><code>MotivationPoints</code></li>
          <li><code>BonusPoints</code></li>
          <li><code>TotalPoints</code> (that day)</li>
          <li><code>CumulativePoints</code> (running total)</li>
        </ul>
      </li>
    </ul>

    <h3>2.7 <code>Brain_Suggestions</code></h3>
    <p><strong>Purpose:</strong> store Ma‚Äôat‚Äôs weekly suggestions.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>Timestamp</code></li>
          <li><code>Tenant</code></li>
          <li><code>WeekKey</code></li>
          <li><code>SuggestionType</code> (coach_suggestion, plan_tweak, badge_award, alert_human_coach)</li>
          <li><code>UserID</code></li>
          <li><code>Channel</code> (for coach_suggestion)</li>
          <li><code>Priority</code></li>
          <li><code>Message</code> (for coach_suggestion / alerts)</li>
          <li><code>RecommendationJson</code> (for plan_tweak / badge_award)</li>
          <li><code>RawJson</code></li>
          <li><code>Status</code> (new, queued, applied, dismissed)</li>
          <li><code>AppliedBy</code></li>
          <li><code>AppliedAt</code></li>
          <li><code>Notes</code></li>
        </ul>
      </li>
    </ul>

    <h3>2.8 <code>Mufasa_HealQueue</code></h3>
    <p><strong>Purpose:</strong> auto-heal actions from Ma‚Äôat.</p>
    <ul>
      <li><strong>Columns:</strong>
        <ul>
          <li><code>Timestamp</code></li>
          <li><code>Tenant</code></li>
          <li><code>ActionType</code> (schema_fix, script_patch, trigger_fix, point_policy_suggestion)</li>
          <li><code>TargetSheet</code></li>
          <li><code>TargetFile</code></li>
          <li><code>TargetFunction</code></li>
          <li><code>Description</code></li>
          <li><code>PatchJson</code></li>
          <li><code>Status</code> (NEW, APPLIED, DISMISSED)</li>
          <li><code>AppliedBy</code></li>
          <li><code>AppliedAt</code></li>
          <li><code>Notes</code></li>
        </ul>
      </li>
    </ul>

    <h3>2.9 Content Tables (for AppSheet & Discord)</h3>
    <p><strong>Purpose:</strong> content banks for affirmations, facts, tips, etc.</p>
    <ul>
      <li><code>Content_Affirmations</code> ‚Äì <code>ID</code>, <code>Chakra</code>, <code>Text</code></li>
      <li><code>Content_ChakraFacts</code> ‚Äì <code>ID</code>, <code>Chakra</code>, <code>Fact</code></li>
      <li><code>Content_LimbLessons</code> ‚Äì <code>ID</code>, <code>WeekNumber</code>, <code>Limb</code>,
          <code>DayOfWeek</code>, <code>Lesson</code>, <code>Question</code>, <code>Action</code></li>
      <li><code>Content_PranaFacts</code>, <code>Content_YogaFacts</code>, <code>Content_SoundBowlFacts</code>,
          <code>Content_NutritionFacts</code> ‚Äì <code>ID</code>, <code>Text</code>, <code>Tag</code></li>
      <li><code>Content_MotivationPosts</code> ‚Äì <code>ID</code>, <code>Text</code></li>
      <li><code>Content_WorkoutTips</code>, <code>Content_YogaTips</code>, <code>Content_LeaderboardTemplates</code></li>
    </ul>
  </section>

  <section id="apps-script">
    <h2>3. Apps Script Modules & Logic</h2>

    <h3>3.1 <code>Config.gs</code></h3>
    <p><strong>Purpose:</strong> read config from <code>00_Config</code>.</p>
    <pre><code>// Pseudo-interface
function BRAIN_getConfig_() { /* returns { brainBaseUrl, brainApiKey, brainTenantId, ... } */ }
function CFG_get(key) { /* convenience getter */ }</code></pre>

    <h3>3.2 <code>Brain_Api.gs</code></h3>
    <p><strong>Purpose:</strong> all HTTP calls to Ma‚Äôat.</p>
    <pre><code>function Brain_callApi_(path, payload) {
  // Reads base URL + API key from 00_Config
  // Sends POST with Authorization: Bearer, X-Tenant, Content-Type: application/json
}

function Brain_PlanWorkout(userObj, planRequestObj) {
  // Wraps POST /plan/workout
}

function Brain_SendWeeklySnapshot(snapshotObj) {
  // Wraps POST /mvp/weekly_snapshot
}

function Brain_SendHealthSnapshot(healthObj) {
  // Wraps POST /mvp/health_snapshot
}</code></pre>

    <h3>3.3 <code>Events_PointsEngine.gs</code></h3>
    <p><strong>Purpose:</strong> convert Events ‚Üí PointsLedger with no double-counting.</p>
    <pre><code>function Events_RecordEvent_(eventObj) {
  // Insert into Events: EventID, UserID, Timestamp, EventType, Source, PayloadJson, Status='pending'
}

function Events_ApplyPoints() {
  // 1. Read Events where Status='pending'
  // 2. For each, apply point rules (water, meals, affirmations, workouts, motivation)
  // 3. Update PointsAwarded, DeDupeKey, Status
  // 4. Call Points_UpdateLedgerFromEvents_()
}

function Points_UpdateLedgerFromEvents_() {
  // Aggregate Events into PointsLedger by UserID + Date
}</code></pre>

    <div class="card">
      <h4>Point Rules (summary for the coding bot)</h4>
      <ul>
        <li><strong>Water</strong>
          <ul>
            <li>Morning & evening slots/day; each slot = 10 pts.</li>
            <li>Max water points/day = 20.</li>
            <li>Extra events in same slot/date ‚Üí <code>Status='ignored_duplicate'</code>.</li>
          </ul>
        </li>
        <li><strong>Meals (Melanin diet)</strong>
          <ul>
            <li>Parse <code>PayloadJson.ingredients</code>.</li>
            <li>Each ‚Äúmelanin food‚Äù from content list = +5 pts (or your chosen value).</li>
          </ul>
        </li>
        <li><strong>Affirmations</strong>
          <ul>
            <li><code>affirmation_text</code> ‚Üí 5 pts/day.</li>
            <li><code>affirmation_video</code> ‚Üí 15 pts/day.</li>
            <li>Only first of each type per day counts.</li>
          </ul>
        </li>
        <li><strong>Workouts</strong>
          <ul>
            <li>Read <code>Users.WorkoutsPerWeekTarget</code>.</li>
            <li><code>workout_checkin_text</code> 10 pts; <code>_photo</code> 15 pts; <code>_video</code> 25 pts.</li>
            <li>If multiple per day, use highest tier; optional weekly cap at target.</li>
          </ul>
        </li>
        <li><strong>Motivation</strong>
          <ul>
            <li>Tally <code>motivation_vote</code> events; winner gets a <code>motivation_award</code> event with +50 pts.</li>
          </ul>
        </li>
        <li><strong>Double-Count Protection</strong>
          <ul>
            <li>Compute <code>DeDupeKey = userId|date|category</code> for each scoring category.</li>
            <li>If existing applied event has same key ‚Üí mark new as duplicate.</li>
          </ul>
        </li>
      </ul>
    </div>

    <h3>3.4 <code>Brain_WeeklySnapshot.gs</code></h3>
    <p><strong>Purpose:</strong> send behavioral summary to Ma‚Äôat and store suggestions.</p>
    <pre><code>function Brain_BuildWeeklySnapshot_() {
  // Compute weekKey (e.g. Monday date)
  // For each user:
  //   - Read workoutsCompleted, waterEvents, mealScore, affirmationCount, totalPoints, tags, etc.
  // Return { tenant: 'fitness_mvp', weekKey, members: [...] }
}

function Brain_WeeklySnapshot() {
  var snapshot = Brain_BuildWeeklySnapshot_();
  var response = Brain_SendWeeklySnapshot(snapshot);
  Brain_WriteSuggestions_(response);
}

function Brain_WriteSuggestions_(response) {
  // Write response.suggestions[] into Brain_Suggestions
}</code></pre>

    <h3>3.5 <code>Mufasa_BrainHealth.gs</code></h3>
    <p><strong>Purpose:</strong> Mufasa asks Ma‚Äôat for system auto-heal advice.</p>
    <pre><code>function Mufasa_BuildHealthSnapshot_() {
  // Collect trigger states, sheet schemas, simple error counts
  // Return { tenant: 'fitness_mvp', purpose: 'health_check', triggers: [...], schema: {...}, errors: [...] }
}

function Mufasa_SendHealthSnapshotToBrain() {
  var health = Mufasa_BuildHealthSnapshot_();
  var response = Brain_SendHealthSnapshot(health);
  Mufasa_WriteActionsToQueue_(response);
}

function Mufasa_WriteActionsToQueue_(response) {
  // Write response.actions[] into Mufasa_HealQueue
}</code></pre>

    <h3>3.6 <code>Discord_Posting.gs</code></h3>
    <p><strong>Purpose:</strong> send leaderboard, prompts, and tips to Discord.</p>
    <pre><code>function Discord_post_(configKey, message) {
  // Reads webhook URL from 00_Config[configKey]
  // POST { content: message } to Discord
}

function Discord_PostLeaderboardDaily() { /* uses PointsLedger */ }
function Discord_PostCheckinPrompt() {}
function Discord_PostMotivation() {}
function Discord_PostWorkoutTip() {}
function Discord_PostNutritionTip() {}</code></pre>

    <p class="meta">
      Time-driven triggers call these at your chosen times (e.g. 8:00‚Äì8:20 AM sequence).
    </p>
  </section>

  <section id="brain-api">
    <h2>4. Big Brain API (Ma‚Äôat)</h2>

    <div class="card">
      <h3>4.1 Shared Rules</h3>
      <ul>
        <li>Always include tenant: <code>"fitness_mvp"</code>.</li>
        <li>Use <code>UserID</code> from the Users sheet as canonical <code>userId</code>.</li>
        <li>Headers:
          <ul>
            <li><code>Authorization: Bearer &lt;brainApiKey&gt;</code></li>
            <li><code>X-Tenant: fitness_mvp</code></li>
            <li><code>Content-Type: application/json</code></li>
          </ul>
        </li>
      </ul>
    </div>

    <h3>4.2 <code>POST /plan/workout</code></h3>
    <p><strong>Purpose:</strong> generate structured plan for a user.</p>
    <pre><code>// Request (example)
{
  "client": {
    "id": "user_123",
    "name": "Marleigh",
    "age": 9,
    "experience": "intermediate",
    "sport": "gymnastics"
  },
  "goals": {
    "primary": "Level 4-5 floor & beam fundamentals",
    "secondary": ["strength", "flexibility"],
    "constraints": ["3 sessions/week", "home + gym mix"]
  },
  "duration_weeks": 4,
  "sessions_per_week": 3,
  "tags": ["gymnastics", "youth"],
  "context": {
    "planType": "gymnastics-l4-5",
    "injuries": ["right ankle sprain"],
    "upcoming_event": "meet_in_6_weeks"
  }
}</code></pre>

    <pre><code>// Response (shape)
{
  "plan_id": "pln_2025-11-13_001",
  "tenant": "fitness_mvp",
  "client": { "id": "user_123", "name": "Marleigh" },
  "goals": { ... },
  "duration_weeks": 4,
  "sessions_per_week": 3,
  "sources": [
    "01_lego_training_blocks.txt",
    "02_nasm_movement_basics.txt",
    "04_gymnastics_fundamentals_L3_L5.txt"
  ],
  "microcycle": [
    {
      "day": "Session 1",
      "focus": "Floor basics + core",
      "warmup": [...],
      "main": [...],
      "accessory": [...],
      "flexibility": [...],
      "cues": [...]
    }
  ],
  "notes": [...],
  "meta": {
    "created_at": "2025-11-13T18:45:00Z",
    "version": "v1",
    "brain_profile": "gymnastics_elite_track"
  }
}</code></pre>

    <h3>4.3 <code>POST /mvp/weekly_snapshot</code></h3>
    <p><strong>Purpose:</strong> send weekly behavior; receive suggestions.</p>
    <pre><code>// Request (shape)
{
  "tenant": "fitness_mvp",
  "weekKey": "2025-11-10",
  "members": [
    {
      "userId": "user_123",
      "name": "Marleigh",
      "discordHandle": "@Marleigh",
      "workoutsPerWeekTarget": 4,
      "workoutsCompleted": 3,
      "totalPoints": 220,
      "waterEvents": 10,
      "mealScore": 55,
      "affirmationCount": 7,
      "planType": "gymnastics-l4-5",
      "tags": ["gymnastics", "youth", "elite-track"],
      "flags": ["ankle_injury"],
      "streaks": {
        "workout_days_in_a_row": 3,
        "water_days_in_a_row": 4
      },
      "history_summary": {
        "weeks_on_program": 6,
        "avg_workouts_per_week": 3.2
      }
    }
  ]
}</code></pre>

    <pre><code>// Response (shape)
{
  "tenant": "fitness_mvp",
  "weekKey": "2025-11-10",
  "generated_at": "2025-11-13T19:00:00Z",
  "suggestions": [
    {
      "type": "coach_suggestion",
      "userId": "user_123",
      "channel": "#daily-checkin",
      "priority": "normal",
      "message": "You hit 3/4 sessions again. Let‚Äôs officially lock in 3 and use the 4th as a flex/stretch day. Consistency &gt; perfection.",
      "tags": ["encouragement", "consistency"]
    },
    {
      "type": "plan_tweak",
      "userId": "user_123",
      "priority": "normal",
      "recommendation": {
        "new_workouts_per_week": 3,
        "focus_areas": ["beam basics", "floor confidence", "safe landings"],
        "when_to_apply": "next_block",
        "reason": "3 consistent weeks of 3/4 workouts with strong adherence."
      }
    },
    {
      "type": "badge_award",
      "userId": "another_user",
      "badge": "Streak Star",
      "reason": "7+ day water + workout streak"
    },
    {
      "type": "alert_human_coach",
      "userId": "third_user",
      "severity": "high",
      "reason": "Sudden drop-off after 4 weeks of high engagement.",
      "suggested_message": "I noticed you‚Äôve been quiet this week. Everything okay? No pressure ‚Äî just checking in. üíô"
    }
  ]
}</code></pre>

    <h3>4.4 <code>POST /mvp/session_log</code></h3>
    <p><strong>Purpose:</strong> Unity sends detailed session data.</p>
    <pre><code>// Request (shape)
{
  "tenant": "fitness_mvp",
  "userId": "user_123",
  "sessionId": "sess_123",
  "planId": "pln_2025-11-13_001",
  "startedAt": "2025-11-13T18:00:00Z",
  "endedAt": "2025-11-13T18:25:00Z",
  "device": "unity_ar_ios",
  "exercises": [
    { "name": "Handstand holds", "sets": 5, "duration_seconds": 120, "estimatedQuality": "good" },
    { "name": "Cartwheel progressions", "sets": 4, "estimatedQuality": "needs_work" }
  ],
  "self_report": {
    "rpe": 7,
    "mood": "tired",
    "pain": "none"
  }
}</code></pre>

    <pre><code>// Response
{ "ok": true }</code></pre>

    <h3>4.5 <code>POST /mvp/health_snapshot</code></h3>
    <p><strong>Purpose:</strong> Mufasa sends system health; Ma‚Äôat returns auto-heal suggestions.</p>
    <pre><code>// Request (shape)
{
  "tenant": "fitness_mvp",
  "purpose": "health_check",
  "triggers": [...],
  "schema": {...},
  "errors": [...]
}</code></pre>

    <pre><code>// Response (shape)
{
  "actions": [
    {
      "type": "schema_fix",
      "target": { "sheet": "PointsLedger" },
      "description": "Add missing 'CumulativePoints' column.",
      "patch": { "add_columns": [ { "name": "CumulativePoints", "position": "end", "default": 0 } ] }
    },
    {
      "type": "script_patch",
      "target": { "file": "/engine/PointsRules.gs", "function": "applyWaterPoints" },
      "description": "Prevent double-counting water when Discord + Form both log.",
      "patch": "/* new function body or diff for review */"
    },
    {
      "type": "trigger_fix",
      "target": { "triggerName": "FiveMinuteHeartbeat" },
      "description": "Trigger not seen in 45+ minutes; recreate with 5-min schedule.",
      "patch": { "triggerType": "time", "everyMinutes": 5 }
    }
  ]
}</code></pre>

  </section>

  <section id="appsheet">
    <h2>5. AppSheet App (Today View & Forms)</h2>

    <h3>5.1 Tables</h3>
    <ul>
      <li><strong>Main tables</strong> ‚Äì <code>Users</code>, <code>Plans</code>, <code>Sessions</code>,
          <code>PointsLedger</code>, <code>Events</code> (hidden), content tables.</li>
    </ul>

    <h3>5.2 ‚ÄúToday‚Äù View</h3>
    <p><strong>Goal:</strong> when user opens the app, they instantly see what today is about.</p>
    <ul>
      <li>Use <code>TODAY()</code> to compute:
        <ul>
          <li>Day of week (Sun‚ÄìSat)</li>
          <li>Program week (from <code>Users.StartDate</code>)</li>
        </ul>
      </li>
      <li>Lookup from content tables:
        <ul>
          <li>Active limb lesson for current week + day.</li>
          <li>Chakra of the day + affirmation.</li>
        </ul>
      </li>
      <li>Display:
        <ul>
          <li>Today‚Äôs lesson focus.</li>
          <li>Today‚Äôs affirmation & chakra.</li>
          <li>Checklist: water AM/PM, workout today?, reflection done?</li>
        </ul>
      </li>
    </ul>

    <h3>5.3 Check-In Form</h3>
    <p><strong>Goal:</strong> easy logging that becomes Events.</p>
    <ul>
      <li>Fields:
        <ul>
          <li>Type: Workout / Water / Meal / Affirmation.</li>
          <li>Media: optional image/video URL.</li>
          <li>Notes, RPE, Mood.</li>
        </ul>
      </li>
      <li>On submit:
        <ul>
          <li>Write a row to <code>Events</code> or call an Apps Script webhook that calls <code>Events_RecordEvent_()</code>.</li>
        </ul>
      </li>
    </ul>

    <h3>5.4 Plan & Leaderboard Views</h3>
    <ul>
      <li><strong>Plan View:</strong> show user‚Äôs current plan, either directly from <code>PlanJson</code> or an unpacked structure.</li>
      <li><strong>Leaderboard:</strong> view on <code>PointsLedger</code> grouped by <code>UserID</code>, ordered by <code>CumulativePoints</code>.</li>
    </ul>
  </section>

  <section id="discord">
    <h2>6. Discord Structure & Event Flow</h2>

    <h3>6.1 Channels</h3>
    <ul>
      <li><code>#how-to-earn-points</code></li>
      <li><code>#water-checkin</code></li>
      <li><code>#meals</code></li>
      <li><code>#workout-checkin</code></li>
      <li><code>#affirmations</code></li>
      <li><code>#motivation</code></li>
      <li><code>#leaderboard</code></li>
      <li><code>#announcements</code></li>
    </ul>

    <h3>6.2 Event Flow</h3>
    <ul>
      <li>User posts in a channel.</li>
      <li>Discord bot:
        <ul>
          <li>Maps Discord handle ‚Üí <code>UserID</code> in <code>Users</code>.</li>
          <li>Determines <code>EventType</code> based on channel & content.</li>
          <li>Builds payload with timestamp, media links, etc.</li>
          <li>POSTs to Apps Script webhook.</li>
        </ul>
      </li>
      <li>Apps Script webhook:
        <ul>
          <li>Calls <code>Events_RecordEvent_()</code>, inserting a row into <code>Events</code>.</li>
        </ul>
      </li>
      <li>Scheduled <code>Events_ApplyPoints()</code> converts into points and updates <code>PointsLedger</code>.</li>
    </ul>

    <h3>6.3 Daily Automation Sequence (Example)</h3>
    <ul>
      <li>08:00 ‚Äì <code>Discord_PostLeaderboardDaily()</code></li>
      <li>08:05 ‚Äì <code>Discord_PostCheckinPrompt()</code></li>
      <li>08:10 ‚Äì <code>Discord_PostMotivation()</code></li>
      <li>08:15 ‚Äì <code>Discord_PostWorkoutTip()</code></li>
      <li>08:20 ‚Äì <code>Discord_PostNutritionTip()</code></li>
    </ul>
  </section>

  <section id="unity">
    <h2>7. Unity / AR Coach & Firebase</h2>

    <h3>7.1 Firestore Data Model</h3>
    <ul>
      <li><strong>Coach scripts (Brain ‚Üí Unity)</strong><br />
        Collection:
        <code>users/{userId}/coach_scripts/{sessionId}</code>
      </li>
      <li><strong>Session logs (Unity ‚Üí Brain)</strong><br />
        Collection:
        <code>users/{userId}/session_logs/{sessionId}</code>
      </li>
    </ul>

    <h3>7.2 Coach Script Document (example)</h3>
    <pre><code>{
  "tenant": "fitness_mvp",
  "userId": "user_123",
  "sessionId": "sess_2025-11-13_001",
  "planId": "pln_2025-11-13_001",
  "title": "Lower Body Strength + Core",
  "intro": {
    "text": "Today we're focusing on strong legs and a solid core.",
    "voiceLine": "intro_legs_core_1"
  },
  "steps": [
    {
      "stepId": "warmup_1",
      "type": "warmup",
      "animation": "coach_jog_in_place",
      "durationSeconds": 60,
      "text": "Jog in place to get your blood flowing.",
      "cues": ["Land softly on your feet.", "Breathe in through your nose, out through your mouth."]
    },
    {
      "stepId": "main_1",
      "type": "exercise",
      "exerciseName": "Bodyweight Squats",
      "animation": "coach_squat_demo",
      "sets": 3,
      "reps": 12,
      "restSeconds": 30,
      "text": "3 sets of 12 squats. Follow my form.",
      "cues": ["Knees track over toes.", "Keep your chest up.", "Go as low as feels safe."]
    }
  ],
  "outro": {
    "text": "Nice work today. Log how you feel, and we‚Äôll keep building.",
    "voiceLine": "outro_good_job_1"
  },
  "meta": {
    "createdAt": "2025-11-13T20:00:00Z",
    "profile": "general_fitness"
  }
}</code></pre>

    <h3>7.3 Session Log Document (example)</h3>
    <pre><code>{
  "tenant": "fitness_mvp",
  "userId": "user_123",
  "sessionId": "sess_2025-11-13_001",
  "planId": "pln_2025-11-13_001",
  "startedAt": "2025-11-13T20:05:00Z",
  "endedAt": "2025-11-13T20:32:00Z",
  "device": "unity_ar_ios",
  "stepsCompleted": [
    { "stepId": "warmup_1", "completed": true, "durationSeconds": 60 },
    { "stepId": "main_1", "completedSets": 3, "targetSets": 3, "notes": "User slowed down in last set." }
  ],
  "selfReport": {
    "rpe": 7,
    "mood": "tired",
    "pain": "none"
  },
  "meta": { "uploadedAt": "2025-11-13T20:33:10Z", "appVersion": "1.0.0" }
}</code></pre>

    <h3>7.4 Unity Side: CoachSessionManager (Concept)</h3>
    <pre><code>// High-level behavior:
Start:
  - Set userId + sessionId
  - Fetch coach_scripts/{sessionId} for that user
  - Map to CoachScript object
  - Initialize SessionLog

Run:
  - Show intro text/voice
  - For each step:
      * Play animation on Animator (step.animation)
      * Show text + cues
      * Wait durationSeconds or run simple sets/reps loop
      * Record completion into SessionLog.stepsCompleted

End:
  - Collect self-report (RPE, mood, pain)
  - Set endedAt
  - Upload to users/{userId}/session_logs/{sessionId}</code></pre>
  </section>

  <section id="rebuild-checklist">
    <h2>8. Fresh-Start Rebuild Checklist</h2>

    <ol class="checklist">
      <li>Create new Spreadsheet <strong>Fitness_MVP_v2</strong>.</li>
      <li>Add tabs + headers exactly as in Section 2.</li>
      <li>Fill <code>00_Config</code> with Brain URL, API key, Discord webhooks, tenant ID.</li>
      <li>Create Apps Script project attached to the Sheet:
        <ul>
          <li>Add files: <code>Config.gs</code>, <code>Brain_Api.gs</code>, <code>Brain_WeeklySnapshot.gs</code>,
              <code>Mufasa_BrainHealth.gs</code>, <code>Events_PointsEngine.gs</code>, <code>Discord_Posting.gs</code>.</li>
          <li>Implement functions described in Section 3.</li>
          <li>Set triggers:
            <ul>
              <li><code>Events_ApplyPoints</code> (every 5‚Äì15 minutes).</li>
              <li><code>Points_UpdateLedgerFromEvents_</code> (daily).</li>
              <li><code>Brain_WeeklySnapshot</code> (weekly).</li>
              <li><code>Mufasa_SendHealthSnapshotToBrain</code> (daily/hourly).</li>
              <li>Discord posting functions for morning sequence.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Build AppSheet app on top of the Sheet:
        <ul>
          <li>‚ÄúToday‚Äù view (date ‚Üí week/day ‚Üí limb/chakra/affirmation).</li>
          <li>Check-In form writing to <code>Events</code>.</li>
          <li>Plan view & Leaderboard view.</li>
        </ul>
      </li>
      <li>Set up Discord:
        <ul>
          <li>Create channels from Section 6.</li>
          <li>Create bot/webhooks that forward events ‚Üí Apps Script webhook ‚Üí <code>Events_RecordEvent_()</code>.</li>
        </ul>
      </li>
      <li>Deploy Big Brain (Ma‚Äôat) with endpoints in Section 4 and mount all training docs.</li>
      <li>Set up Firebase/Firestore with collections:
        <ul>
          <li><code>users/{userId}/coach_scripts/{sessionId}</code></li>
          <li><code>users/{userId}/session_logs/{sessionId}</code></li>
        </ul>
      </li>
      <li>Wire Unity:
        <ul>
          <li>Import Firebase SDK for Firestore.</li>
          <li>Implement <code>CoachSessionManager</code> to pull coach scripts and push session logs.</li>
        </ul>
      </li>
      <li>Run end-to-end smoke tests:
        <ul>
          <li>Discord post ‚Üí Events ‚Üí PointsLedger ‚Üí leaderboard ‚Üí Discord.</li>
          <li>AppSheet check-in ‚Üí Events ‚Üí PointsLedger.</li>
          <li>Plan request ‚Üí <code>/plan/workout</code> ‚Üí Plans tab.</li>
          <li>Weekly snapshot ‚Üí <code>/mvp/weekly_snapshot</code> ‚Üí Brain_Suggestions.</li>
          <li>Unity session ‚Üí Firestore ‚Üí <code>/mvp/session_log</code>.</li>
        </ul>
      </li>
    </ol>

    <p class="meta">
      Once this checklist is complete, Ma‚Äôat (Big Brain) and Mufasa (governance)
      will be fully wired into Fitness MVP, with Unity as the moving body
      and Discord/AppSheet as the community nervous system.
    </p>
  </section>
</main>
</body>
</html>
